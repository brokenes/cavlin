package com.github.admin.filter;

import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebFilter;

import org.apache.shiro.web.servlet.AdviceFilter;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.annotation.Order;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.serializer.SerializerFeature;
import com.github.admin.common.vo.ResultVo;
import com.github.admin.handle.ExceptionHandle;

@Order(1)
@WebFilter(filterName = "loginFilter", urlPatterns = "/*")
public class LoginFilter extends AdviceFilter{

	private final static Logger logger = LoggerFactory.getLogger(ExceptionHandle.class);
	
	private static final SerializerFeature[] features = {
			SerializerFeature.DisableCircularReferenceDetect,//打开循环引用检测，JSONField(serialize = false)不循环
			SerializerFeature.WriteDateUseDateFormat,//默认使用系统默认 格式日期格式化
           };
	
	protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception {
		logger.info("...............shiro filter........");
		
				
		ResultVo result = new ResultVo();
		result.setCode("10110");
		result.setMsg("登录超时!");
		result.setData("");
		result.setSuccess(false);
//		byte[] bytes = JSON.toJSONBytes(result, features);
		response.setCharacterEncoding("utf-8");
		response.setContentType("application/json; charset=utf-8");
		response.getWriter().write(JSON.toJSONString(result));
        return false;
    }

}
